\documentclass[a4paper,12pt]{article}
\usepackage[spanish]{babel}

% Packages - Plantilla
\usepackage{graphicx}
\usepackage{amsmath}
\usepackage{geometry}
\usepackage{fancyhdr}
\usepackage{setspace}
\usepackage{titlesec}  % For title formatting
\usepackage{tocloft}
\usepackage[colorlinks=true,linkcolor=black,citecolor=black,urlcolor=blue]{hyperref}
\usepackage{enumitem}
\setlist[itemize]{topsep=0pt, label=\textbullet, itemsep=0pt}
\usepackage{caption}
\captionsetup[table]{name=Tabla}

% Packages - User
\input{configuraciones/code}  % Configuración para snippets de código C/C++/CUDA

% Información de la práctica
\newcommand{\autor}{Pablo González Segarra}
\newcommand{\titulo}{Práctica 2}
\newcommand{\subtitulo}{Parte 1: Compilando Programas en C}
\newcommand{\fecha}{\today}
\newcommand{\titulacion}{Máster Universitario en Ingeniería de Computadores y Redes}

% Header and Footer
\pagestyle{fancy}
\fancyhf{}
\fancyhead[L]{\titulo}
\fancyhead[R]{\thepage}
\setlength{\headheight}{15pt}

% Other configurations
\geometry{margin=1in}
\setlength{\parskip}{0.5\baselineskip}
\setlength{\cftbeforesecskip}{0pt} % Espacio entre entradas del índice

% Tittle page
\input{tittle/tittle}

% Document
\begin{document}
% Title Page
\maketitle
\thispagestyle{empty}
\vfill

% Table of Contents
\setcounter{page}{1}  % Start counting from 1
\tableofcontents
\newpage

% 1
\section*{Ejercicio 1 y 2}\addcontentsline{toc}{section}{Ejercicio 1}
Debido a la similitud entre los ejercicios 1 y 2, se presentan juntos en esta sección.
A continuación se muestra el código modificado necesario para ejecutar el programa
en la GPU utilizando CUDA y comprobar que los resultados son correctos.
\lstinputlisting[
    language=CUDA, 
    style=codestyle, 
    caption={Código CUDA modificado para ejecutar en GPU}
    ]
    {../ej_1_y_2.cu}

% 3
\section*{Ejercicio 3}\addcontentsline{toc}{section}{Ejercicio 3}

El codigo modificado para poder obtener los tiempos de ejecución es el siguiente:

\lstinputlisting[
    language=CUDA, 
    style=codestyle, 
    caption={Código CUDA modificado para medir tiempos de ejecución}
    ]
    {../ej3.cu}

Se ha ejecutado 5 veces para evitar variaciones ajenas al rendimiento del código. El tiempo de 
ejecucion tiene en cuenta tanto la transferencia de datos entre host y device como la 
ejecución del kernel.

Resultado de las ejecuciones:
\begin{enumerate}[topsep=0pt,itemsep=0pt]
    \item 5887.4 ms
    \item 5864.1 ms
    \item 5918.6 ms
    \item 5856.9 ms
    \item 5868.1 ms
\end{enumerate}

Siendo el mejor tiempo 5856.9 ms.

% 4
\section*{Ejercicio 4}\addcontentsline{toc}{section}{Ejercicio 4}

Para comparar la aceleracion obtenida al ejecutar el código en la GPU frente a la CPU,
primero se ha compilado y ejecutado la version original en CPU, obteniendo un tiempo mejor de
992.6 ms.

Para obtener los tiempos de ejecución en GPU con distintas configuraciones numero de bloques
y hilos por bloque, se ha modificado el código del ejercicio 3 para variar estos parámetros. Todas las 
configuraciones se han ejecutardo

\begin{table}[h!]
\centering
\begin{tabular}{lcc}
    \hline
	extbf{Versión} & \textbf{Tiempo de ejecución (ms)} & \textbf{Speedup GPU vs CPU} \\
    \hline
    1 thread / block & & \\
    16 threads / block & & \\
    32 threads / block & & \\
    256 threads / block & & \\
    \hline
\end{tabular}
\caption{Tiempos de ejecución y speedup para distintas configuraciones de hilos/ bloque}
\label{tab:tiempos-speedup}
\end{table}
 
% 5
\section*{Ejercicio 5}\addcontentsline{toc}{section}{Ejercicio 5}

% 6
\section*{Ejercicio 6}\addcontentsline{toc}{section}{Ejercicio 6}

% 7
\section*{Ejercicio 7}\addcontentsline{toc}{section}{Ejercicio 7}



\cleardoublepage
\pagestyle{plain}
% Bibliography (if required)
% \bibliographystyle{ieeetr}
% \bibliography{references.bib}  % Add a .bib file if you have references

\end{document}
